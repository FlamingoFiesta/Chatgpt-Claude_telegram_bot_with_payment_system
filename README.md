# ChatGPT Telegram Bot fork: **No daily limits. Special chat modes** 

<div align="center">
<img src="https://raw.githubusercontent.com/FlamingoFiesta/Chatgpt_telegram_bot_karfly-fork/main/static/header.png" align="center" style="width: 100%" />
</div>

<br>

<p align="center">
<a href="https://t.me/ChatdudBot" alt="Run Telegram Bot shield"><img src="https://img.shields.io/badge/RUN-Telegram%20Bot-blue?logo=data:image/svg+xml;base64,PHN2ZyBpZD0iTGl2ZWxsb18xIiBkYXRhLW5hbWU9IkxpdmVsbG8gMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iMCAwIDI0MCAyNDAiPjxkZWZzPjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZWFyLWdyYWRpZW50IiB4MT0iMTIwIiB5MT0iMjQwIiB4Mj0iMTIwIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjMWQ5M2QyIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMzhiMGUzIi8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHRpdGxlPlRlbGVncmFtX2xvZ288L3RpdGxlPjxjaXJjbGUgY3g9IjEyMCIgY3k9IjEyMCIgcj0iMTIwIiBmaWxsPSJ1cmwoI2xpbmVhci1ncmFkaWVudCkiLz48cGF0aCBkPSJNODEuMjI5LDEyOC43NzJsMTQuMjM3LDM5LjQwNnMxLjc4LDMuNjg3LDMuNjg2LDMuNjg3LDMwLjI1NS0yOS40OTIsMzAuMjU1LTI5LjQ5MmwzMS41MjUtNjAuODlMODEuNzM3LDExOC42WiIgZmlsbD0iI2M4ZGFlYSIvPjxwYXRoIGQ9Ik0xMDAuMTA2LDEzOC44NzhsLTIuNzMzLDI5LjA0NnMtMS4xNDQsOC45LDcuNzU0LDAsMTcuNDE1LTE1Ljc2MywxNy40MTUtMTUuNzYzIiBmaWxsPSIjYTljNmQ4Ii8+PHBhdGggZD0iTTgxLjQ4NiwxMzAuMTc4LDUyLjIsMTIwLjYzNnMtMy41LTEuNDItMi4zNzMtNC42NGMuMjMyLS42NjQuNy0xLjIyOSwyLjEtMi4yLDYuNDg5LTQuNTIzLDEyMC4xMDYtNDUuMzYsMTIwLjEwNi00NS4zNnMzLjIwOC0xLjA4MSw1LjEtLjM2MmEyLjc2NiwyLjc2NiwwLDAsMSwxLjg4NSwyLjA1NSw5LjM1Nyw5LjM1NywwLDAsMSwuMjU0LDIuNTg1Yy0uMDA5Ljc1Mi0uMSwxLjQ0OS0uMTY5LDIuNTQyLS42OTIsMTEuMTY1LTIxLjQsOTQuNDkzLTIxLjQsOTQuNDkzcy0xLjIzOSw0Ljg3Ni01LjY3OCw1LjA0M0E4LjEzLDguMTMsMCwwLDEsMTQ2LjEsMTcyLjVjLTguNzExLTcuNDkzLTM4LjgxOS0yNy43MjctNDUuNDcyLTMyLjE3N2ExLjI3LDEuMjcsMCwwLDEtLjU0Ni0uOWMtLjA5My0uNDY5LjQxNy0xLjA1LjQxNy0xLjA1czUyLjQyNi00Ni42LDUzLjgyMS01MS40OTJjLjEwOC0uMzc5LS4zLS41NjYtLjg0OC0uNC0zLjQ4MiwxLjI4MS02My44NDQsMzkuNC03MC41MDYsNDMuNjA3QTMuMjEsMy4yMSwwLDAsMSw4MS40ODYsMTMwLjE3OFoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=" width="230"/></a>
</p>

This repo is a fork based on [Karfly's](https://github.com/father-bot/chatgpt_telegram_bot) infrastructure, with some added functionalities by me. Please check his repo out, this wouldnt have been possible without him!



This repo is ChatGPT re-created as Telegram Bot, and its 95% ready for you to deploy and potentially earn money

You can deploy your own bot, or use mine: [@Chatdud Bot](https://t.me/ChatdudBot)

## Original features when I started the fork (02.02.2024)
- Low latency replies (it usually takes about 3-5 seconds)
- No request limits
- GPT-4 and support
- Group Chat support (/help_group_chat to get instructions)
- DALLE 2 (choose üë©‚Äçüé® Artist mode to generate images)
- Voice message recognition
- 15 special chat modes: üë©üèº‚Äçüéì Assistant, üë©üèº‚Äçüíª Code Assistant, üë©‚Äçüé® Artist, üß† Psychologist, üöÄ Elon Musk and other. You can easily create your own chat modes by editing `config/chat_modes.yml`
- Support of [ChatGPT API](https://platform.openai.com/docs/guides/chat/introduction)
- List of allowed Telegram users
- Track $ balance spent on OpenAI API

## What I added
- <b>16 new chat modes</b>: Cyber Dud (‚åê‚ñ†_‚ñ†), ‚å®Ô∏è Stenographer (Speech to text),  üíªüüß Grimoire (Advanced coding assitant), üñ•Ô∏è Bash dud (Linux Terminal), ü¶Ü Duck Mode, and a bunch of characters from movies and shows!

- <b>Transcribe</b> voice messages (choose ‚å®Ô∏è Stenographer)

- <b>Selectable</b> DALL-E models and their configurations. You can choose between DALL-E 2 which allows you to generate multiple images at once and DALL-E 3 which allows you to choose the image quality. You can choose the image resolution for both models in /settings "Artist model"

- <b>GPT-4 Vision</b> is finally fully integrated and supported (inspiration taken from multiple places as I had issues)

- <b>Improved</b> start and help messages

- <b>Improved</b> the <b>settings</b> and <b>balance</b> menus, theyre now more user friendly and clean
  
- Payment system using Stripe, updating user balance automatically after payment (redis listener needs to be configured)
  
- Special donation button

- Different user roles: <b>admin</b>, <b>beta tester</b>, <b>friend</b>, <b>regular user</b>, <b>trial user</b>
    - All new users start as a trial user with 1 euro balance, and are automatically upgraded to regular user after first payment
    - Special admin-only commands that can be used directly from the telegram app
  
- <b>Customizable</b> profit margin based on roles in `config/config.example.yml`
    - In the form of "1.xx", xx being the percentage of profit you want
       - 1.1 for 10%, 1.05 for 5% etc.

- Check user balance before making the API call and prompt them to top-up if it's too low. Can be turned off by changing the persona deduction rates to 0

- Tracking the balance in euros and tokens. The default is in euros, advanced users and switch to the token system, the functions are there.


---

## Upcoming
- TBA


## Bot commands
- `/new` ‚Äì Start new dialog
- `/retry` ‚Äì Regenerate last bot answer
- `/mode` ‚Äì Select chat mode
- `/balance` ‚Äì Show balance
- `/topup` ‚Äì Add credits to your account 
- `/settings` ‚Äì Show settings
- `/help` ‚Äì Show the commands
- `/role` ‚Äì Show your role

## Setup
1. Get your [OpenAI API](https://openai.com/api/) key

2. Get your Telegram bot token from [@BotFather](https://t.me/BotFather)

3. Get your Stripe [secret key](https://dashboard.stripe.com/apikeys) (optional if you dont want to use the payment system)

4. Edit `config/config.example.yml` to set your tokens, stripe key (if you choose to use stripe), then run the 2 commands below (*if you're advanced user, you can also edit* `config/config.example.env`):
    ```bash
    mv config/config.example.yml config/config.yml
    mv config/config.example.env config/config.env
    ```
5. Download and install [docker](https://www.docker.com/), then open the app.
   
6. **(Optional)** Setup ngrok to automatically update the users balance after payment and send them a confirmation message (ignore this if you dont want to update your balance automatically and in real time, skip to step 7)

   1. Download ngrok:
        - Go to the ngrok [website](https://ngrok.com/download).
        - Click on the download for your operating system.
        - Sign up or log in on the website to get your authentication token (will be refered to as <YOUR_AUTH_TOKEN>).
          
   2. Unzip the folder
      
   3. Connect your account
        - For MacOS:
          - Open terminal
          - Navigate to the folder where you unziped ngrok (e.g. ```cd Downloads```).
          - Run:
              ```bash
              ./ngrok authtoken <YOUR_AUTH_TOKEN>
             ```    
          - Keep the terminal window open
  
          
        - For Windows:
          - Open Command Prompt.
          - Open terminal and navigate to the folder where you unziped ngrok (e.g. ```cd Downloads```).
          - Run: 
              ```bash
              ngrok.exe authtoken <YOUR_AUTH_TOKEN> 
             ```
              
          - Keep the terminal window open
          
   4. Run ngrok
        - For MacOS:
          - Run: 
              ```bash
              ./ngrok http 5000
             ```  
          - You will see a status screen with the URL next to "Forwarding" in the format of "https://NUMBERS.ngrok-free.app", you will need it in bit
          - Keep the terminal open, ngrok will keep running as long as the terminal window is open.
            
        - For Windows
          - Run: 
             ```bash
              ngrok.exe http 5000
            ```  
          - You will see a status screen with the URL next to "Forwarding" in the format of "https://NUMBERS.ngrok-free.app", you will need it in bit
          - Keep the terminal open, ngrok will keep running as long as the terminal window is open.
            
    5. Add the webhook endpoint to the Stripe dashboard
        - Go to the [webhook](https://dashboard.stripe.com/webhooks) section in your stripe dashboard by following the link or find it under the ```Developers``` section
        - Click ```Add endpoint```
        - In the ```Endpoint URL``` field, enter the URL you got from ngrok followed by **/stripe-webhook**
          - For this example it would be ```https://NUMBERS.ngrok-free.app/stripe-webhook```
        - Click ```+Select events```
        - Under the **Checkout** section, select ```checkout.session.completed```. Now **Add event** then **Add endpoint**.
        - Click on **Reveal** under **Signing secret** and copy the webhook secret
          
    6. Edit `config/config.yml` to set your webhook secret
       
    7. Please note that the free plan for ngrok gives you a new URL everytime you run the service, which means that you have to keep it running all the time and update the URL in the         stripe dashboard if you restart ngrok. For a static domain, you need to have the paid subscription.
       
    8. Now youre done setting up the payment system, good job! 
          
7. **(Optional for those that havent configured the payment system but recommended for efficiency)** If you did not configure the payment system with stripe, you can run the bot as is but it will create two extra containers that have no use for you which will use extra memory. Edit the ```docker-compose.yml``` file, find the comment that says ```payment``` and delete the redis line, also find the comment that says ```#delete everything below if not payment system``` and delete everything that is under it.
    - At the moment, if you select a payment ammount youll get an error stating you dont have the API key, in the future I'll make it handle the error gracefuly and send a message           stating that you did not configure the payment system.

8. üî• And now, cd to the ```Chatgpt_telegram_bot_karfly-fork``` directory **run**:
    ```bash
    docker-compose --env-file config/config.env up --build
    ```
##

## ‚ù§Ô∏è Top Donations
If you found my fork useful, use the topup command in my bot for any donations!
Send me a message so that I know it was you who donated, you can be on this list:

## Contributors
- [Karfly](https://github.com/father-bot/chatgpt_telegram_bot) for the foundation of the code
- FlamingoFiesta


